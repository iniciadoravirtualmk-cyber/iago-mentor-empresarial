<script>
  // üîó URL do Apps Script da assinatura do IAGO
  const SCRIPT_URL_ASSINATURA =
    "https://script.google.com/macros/s/AKfycbwvjGD1CUThtKdEfwVzszUxHgBBikGfzP3uMsMxYfmzYon7haWS1Z43_dKtxr2EN3-g/exec";

  // üîó Link do IAGO (vers√£o assinantes)
  const IAGO_ASSINATURA_URL =
    "https://chatgpt.com/g/g-692f7cea2ad881919bc1787dcff00a65-iago-mentor-empresarial";

  const form = document.getElementById("access-form");
  const emailInput = document.getElementById("email");
  const msgEl = document.getElementById("message");
  const btn = document.getElementById("submit-btn");

  function setLoading(isLoading) {
    btn.disabled = isLoading;
    btn.innerHTML = isLoading
      ? '<span class="loader"></span>Verificando...'
      : "Entrar";
  }

  function showError(message) {
    msgEl.textContent =
      message ||
      "Este e-mail ainda n√£o est√° autorizado na assinatura. Verifique se digitou corretamente ou aguarde a confirma√ß√£o do pagamento.";
    msgEl.className = "msg error";
  }

  function showSuccess(message) {
    msgEl.textContent = message;
    msgEl.className = "msg success";
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const email = emailInput.value.trim().toLowerCase();

    if (!email) {
      showError("Por favor, preencha o e-mail.");
      return;
    }

    setLoading(true);
    msgEl.textContent = "";
    msgEl.className = "msg";

    try {
      const res = await fetch(
        `${SCRIPT_URL_ASSINATURA}?email=${encodeURIComponent(email)}`,
        { method: "GET" }
      );

      if (!res.ok) {
        throw new Error("Erro de conex√£o. Tente novamente.");
      }

      const data = await res.json();

      // üîí VALIDA√á√ÉO FINAL E √öNICA
      if (data && data.authorized === true) {
        showSuccess("E-mail autorizado! Redirecionando para o IAGO...");
        setTimeout(() => {
          window.location.href = IAGO_ASSINATURA_URL;
        }, 800);
      } else {
        showError(data?.message);
      }
    } catch (err) {
      showError(err?.message || –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ);
    } finally {
      setLoading(false);
    }
  });
</script>
