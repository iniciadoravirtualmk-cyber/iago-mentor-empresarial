<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Teste DISC - IAGO Mentor</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- libs para gerar PDF (client-side) -->
  <script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #000000;
      color: #ffffff;
    }
    .disc-red { background-color: #E63946; }
    .disc-yellow { background-color: #FFBE0B; }
    .disc-green { background-color: #06D6A0; }
    .disc-blue { background-color: #118AB2; }
    .disc-red-text { color: #E63946; }
    .disc-yellow-text { color: #FFBE0B; }
    .disc-green-text { color: #06D6A0; }
    .disc-blue-text { color: #118AB2; }

    .progress-container {
      height: 8px;
      background-color: #333333;
      border-radius: 4px;
      margin: 10px 0;
    }
    .progress-bar {
      height: 100%;
      border-radius: 4px;
      transition: width 0.5s ease;
    }
    .question-container {
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    .chart-column {
      width: 50px;
      margin: 0 10px;
      border-radius: 6px 6px 0 0;
      transition: height 1s ease;
    }
    .option-selected {
      background-color: rgba(242, 191, 65, 0.2);
      border-color: #f2bf41 !important;
    }
    .option-selected .radio-dot {
      background-color: #f2bf41;
    }

    /* bloco do relatório */
    .report-container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background-color: #121212;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }
    .report-header {
      text-align: center;
      padding: 20px 0;
      border-bottom: 2px solid #333;
      margin-bottom: 30px;
    }
    .report-header h1 {
      margin: 0;
      color: #f2bf41;
      font-size: 28px;
    }
    .report-user-info {
      background-color: #1a1a1a;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      border-left: 4px solid #f2bf41;
    }
    .report-user-info h2 {
      margin-top: 0;
      color: #f2bf41;
    }
    .report-profile-section { margin-bottom: 30px; }
    .report-profile-section h2 {
      color: #f2bf41;
      border-bottom: 1px solid #333;
      padding-bottom: 10px;
    }
    .report-chart-container {
      display: flex;
      justify-content: space-between;
      margin-bottom: 40px;
      gap: 20px;
      flex-wrap: wrap;
    }
    .report-chart { width: 48%; min-width: 320px; }
    .report-profile-description {
      width: 48%;
      min-width: 320px;
      padding: 20px;
      background-color: #1a1a1a;
      border-radius: 8px;
    }
    .report-disc-chart {
      display: flex;
      align-items: flex-end;
      height: 250px;
      justify-content: center;
      padding: 20px;
    }
    .report-chart-column {
      width: 60px;
      margin: 0 15px;
      border-radius: 6px 6px 0 0;
      position: relative;
    }
    .report-chart-label {
      text-align: center;
      margin-top: 10px;
      font-weight: bold;
    }
    .report-chart-percentage {
      text-align: center;
      font-size: 14px;
    }
    .report-info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }
    .report-info-card {
      background-color: #1a1a1a;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #f2bf41;
    }
    .report-info-card h3 {
      margin-top: 0;
      color: #f2bf41;
    }
    .report-thanks-section {
      background-color: #1a1a1a;
      padding: 30px;
      border-radius: 8px;
      margin: 40px 0;
      border-left: 4px solid #f2bf41;
    }
    .report-thanks-section h2 { color: #f2bf41; }
    .report-footer {
      text-align: center;
      padding: 20px 0;
      border-top: 1px solid #333;
      margin-top: 40px;
      color: #888;
      font-size: 14px;
    }
    .report-pdi-section {
      background-color: #1a1a1a;
      padding: 30px;
      border-radius: 8px;
      margin: 40px 0;
      border-left: 4px solid #f2bf41;
    }
    .report-pdi-section h2 { color: #f2bf41; margin-top: 0; }

    @media print {
      .no-print { display: none !important; }
      body { background-color: white; color: black; }
      #test-container { display: none !important; }
      #report-stage { display: block !important; }

      .report-container {
        box-shadow: none;
        max-width: 100%;
        background-color: white;
        color: #000;
      }
      .report-header h1,
      .report-profile-section h2,
      .report-info-card h3,
      .report-thanks-section h2,
      .report-pdi-section h2,
      .report-user-info h2 {
        color: #000;
      }
      .report-user-info, .report-info-card, .report-thanks-section,
      .report-pdi-section, .report-profile-description {
        background-color: #f9f9f9;
        border-left: 4px solid #333;
      }
      .report-chart-column {
        print-color-adjust: exact;
        -webkit-print-color-adjust: exact;
      }
      .disc-red { background-color: #E63946 !important; }
      .disc-yellow { background-color: #FFBE0B !important; }
      .disc-green { background-color: #06D6A0 !important; }
      .disc-blue { background-color: #118AB2 !important; }
    }
  </style>
</head>

<body>
  <!-- Teste DISC Container -->
  <div id="test-container" class="container mx-auto px-4 py-8 max-w-4xl">
    <div class="bg-gray-900 rounded-lg shadow-lg p-8 border border-gray-800">
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold mb-2" style="color: #f2bf41;">IAGO Mentor - Inteligência Artificial Geradora de Oportunidades</h1>
        <h2 class="text-3xl font-bold text-white">Teste de Perfil Comportamental DISC</h2>
        <p class="text-gray-300 mt-2">iagomentor.com.br</p>
      </div>

      <!-- Formulário de Dados -->
      <div id="user-form" class="mb-8">
        <h2 class="text-2xl font-semibold mb-4" style="color: #f2bf41;">Dados Pessoais</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="name" class="block text-white mb-1">Nome Completo</label>
            <input type="text" id="name"
              class="w-full px-4 py-2 border bg-gray-800 text-white border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500">
          </div>
          <div>
            <label for="email" class="block text-white mb-1">E-mail</label>
            <input type="email" id="email"
              class="w-full px-4 py-2 border bg-gray-800 text-white border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500">
          </div>
          <div>
            <label for="age" class="block text-white mb-1">Idade</label>
            <input type="number" id="age"
              class="w-full px-4 py-2 border bg-gray-800 text-white border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500">
          </div>
          <div>
            <label for="profession" class="block text-white mb-1">Profissão</label>
            <input type="text" id="profession"
              class="w-full px-4 py-2 border bg-gray-800 text-white border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500">
          </div>
        </div>

        <!-- LGPD -->
        <div class="mt-4 bg-gray-800 border border-gray-700 rounded-md p-4">
          <p class="text-sm text-gray-200">
            <span class="font-semibold" style="color:#f2bf41;">Privacidade (LGPD):</span>
            Este teste é gratuito e <strong>não armazena</strong> seus dados. As informações preenchidas são usadas apenas para gerar seu relatório nesta página.
          </p>

          <label class="mt-3 flex items-start gap-3 cursor-pointer select-none">
            <input id="lgpd-consent" type="checkbox" class="mt-1 w-4 h-4 accent-yellow-500" />
            <span class="text-sm text-gray-200">
              Estou ciente de que meus dados não serão armazenados e serão usados somente para exibir o resultado e o relatório.
            </span>
          </label>
        </div>

        <div class="mt-6">
          <button id="start-test"
            class="bg-yellow-600 text-white px-6 py-3 rounded-md hover:bg-yellow-700 transition duration-300 font-medium"
            style="background-color: #f2bf41; color: #000000;">Iniciar Teste</button>
        </div>
      </div>

      <!-- Progresso do Teste -->
      <div id="test-progress" class="mb-8 hidden">
        <div class="flex justify-between mb-2">
          <span id="question-counter" class="text-sm font-medium text-white">Questão 1 de 20</span>
          <span id="progress-text" class="text-sm font-medium text-white">0%</span>
        </div>
        <div class="progress-container">
          <div id="progress-bar" class="progress-bar" style="background-color: #f2bf41;"></div>
        </div>
      </div>

      <!-- Questões do Teste -->
      <div id="questions-container" class="hidden"></div>

      <!-- Botões de Navegação -->
      <div id="navigation-buttons" class="flex justify-between mt-6 hidden">
        <button id="prev-question"
          class="px-5 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-600 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed">Voltar</button>
        <button id="next-question"
          class="px-5 py-2 rounded-md transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
          style="background-color: #f2bf41; color: #000000;">Próxima</button>
      </div>

      <!-- Resultados -->
      <div id="results-container" class="hidden">
        <h2 class="text-2xl font-semibold mb-6 text-center" style="color: #f2bf41;">Seu Perfil DISC</h2>

        <div class="flex justify-center mb-8">
          <div class="flex items-end h-64">
            <div class="flex flex-col items-center">
              <div id="d-column" class="chart-column disc-red" style="height: 0%"></div>
              <p class="font-bold mt-2 text-white">D</p>
              <p id="d-percentage" class="text-sm text-white">0%</p>
            </div>
            <div class="flex flex-col items-center">
              <div id="i-column" class="chart-column disc-yellow" style="height: 0%"></div>
              <p class="font-bold mt-2 text-white">I</p>
              <p id="i-percentage" class="text-sm text-white">0%</p>
            </div>
            <div class="flex flex-col items-center">
              <div id="s-column" class="chart-column disc-green" style="height: 0%"></div>
              <p class="font-bold mt-2 text-white">S</p>
              <p id="s-percentage" class="text-sm text-white">0%</p>
            </div>
            <div class="flex flex-col items-center">
              <div id="c-column" class="chart-column disc-blue" style="height: 0%"></div>
              <p class="font-bold mt-2 text-white">C</p>
              <p id="c-percentage" class="text-sm text-white">0%</p>
            </div>
          </div>
        </div>

        <!-- O que é DISC -->
        <div class="bg-gray-800 p-6 rounded-lg mb-6">
          <h3 class="text-xl font-semibold mb-2" style="color:#f2bf41;">O que é o DISC?</h3>
          <p class="text-gray-200">
            DISC é um modelo de perfil comportamental que descreve tendências de estilo de trabalho e comunicação:
            <strong>D</strong> (Dominância), <strong>I</strong> (Influência), <strong>S</strong> (Estabilidade) e <strong>C</strong> (Conformidade/Cautela).
          </p>
          <p class="text-gray-300 mt-2 text-sm">
            <strong>Aviso:</strong> este resultado é uma orientação comportamental, não é diagnóstico psicológico e pode variar conforme o contexto.
          </p>
        </div>

        <div class="bg-gray-800 p-6 rounded-lg mb-8">
          <h3 class="text-xl font-semibold mb-3" style="color: #f2bf41;">Seu Perfil Predominante:</h3>
          <p id="profile-description" class="text-white"></p>
        </div>

        <div class="mt-8 flex flex-col md:flex-row gap-3 justify-center no-print">
          <button id="open-report"
            class="px-6 py-3 rounded-md transition duration-300 font-medium"
            style="background-color: #f2bf41; color: #000000;">Ver Relatório na Tela</button>

          <button id="download-pdf"
            class="px-6 py-3 rounded-md transition duration-300 font-medium bg-gray-700 text-white hover:bg-gray-600 disabled:opacity-50"
            disabled>Baixar PDF</button>

          <button id="print-report"
            class="px-6 py-3 rounded-md transition duration-300 font-medium bg-gray-700 text-white hover:bg-gray-600 disabled:opacity-50"
            disabled>Imprimir</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Stage do Relatório -->
  <div id="report-stage" class="hidden px-4 py-8">
    <div class="max-w-5xl mx-auto mb-4 no-print flex gap-3 justify-end">
      <button id="back-to-results" class="px-4 py-2 rounded bg-gray-700 text-white hover:bg-gray-600">Voltar</button>
      <button id="stage-download-pdf" class="px-4 py-2 rounded" style="background-color:#f2bf41;color:#000;">Baixar PDF</button>
      <button id="stage-print" class="px-4 py-2 rounded bg-gray-700 text-white hover:bg-gray-600">Imprimir</button>
    </div>

    <div id="report-root"></div>
  </div>

  <!-- Template do Relatório -->
  <template id="report-template">
    <div class="report-container" id="report-for-pdf">
      <div class="report-header">
        <h1>IAGO Mentor - Relatório de Perfil DISC</h1>
        <div style="color:#bdbdbd;margin-top:6px;font-size:14px;">iagomentor.com.br</div>
      </div>

      <div class="report-user-info">
        <h2>Dados do Participante</h2>
        <div id="report-user-data"></div>
      </div>

      <div class="report-profile-section">
        <h2>Seu Perfil DISC</h2>
        <div class="report-chart-container">
          <div class="report-chart">
            <div class="report-disc-chart">
              <div>
                <div id="report-d-column" class="report-chart-column disc-red" style="height:0%"></div>
                <div class="report-chart-label">D</div>
                <div id="report-d-percentage" class="report-chart-percentage"></div>
              </div>
              <div>
                <div id="report-i-column" class="report-chart-column disc-yellow" style="height:0%"></div>
                <div class="report-chart-label">I</div>
                <div id="report-i-percentage" class="report-chart-percentage"></div>
              </div>
              <div>
                <div id="report-s-column" class="report-chart-column disc-green" style="height:0%"></div>
                <div class="report-chart-label">S</div>
                <div id="report-s-percentage" class="report-chart-percentage"></div>
              </div>
              <div>
                <div id="report-c-column" class="report-chart-column disc-blue" style="height:0%"></div>
                <div class="report-chart-label">C</div>
                <div id="report-c-percentage" class="report-chart-percentage"></div>
              </div>
            </div>
          </div>

          <div class="report-profile-description">
            <h3 id="report-profile-title" style="color:#f2bf41;">Perfil Predominante</h3>
            <p id="report-profile-description"></p>
          </div>
        </div>
      </div>

      <div class="report-profile-section">
        <h2>Descrição dos Perfis</h2>
        <div id="report-profiles-description"></div>
      </div>

      <div class="report-profile-section">
        <h2>Informações Complementares</h2>
        <div class="report-info-grid">
          <div class="report-info-card">
            <h3>Palavras-chave</h3>
            <div id="report-keywords"></div>
          </div>
          <div class="report-info-card">
            <h3>Motivadores</h3>
            <div id="report-motivators"></div>
          </div>
          <div class="report-info-card">
            <h3>Em Equipe</h3>
            <div id="report-team"></div>
          </div>
          <div class="report-info-card">
            <h3>Área Comercial</h3>
            <div id="report-commercial"></div>
          </div>
        </div>
        <div class="report-info-card">
          <h3>Área Administrativa</h3>
          <div id="report-administrative"></div>
        </div>
      </div>

      <!-- Leitura prática -->
      <div class="report-profile-section">
        <h2>Leitura Prática do Seu Perfil</h2>

        <div class="report-info-card" style="margin-bottom:20px;">
          <h3>Pontos fortes (tendências)</h3>
          <div id="report-strengths"></div>
        </div>

        <div class="report-info-card" style="margin-bottom:20px;">
          <h3>Pontos de atenção</h3>
          <div id="report-watchouts"></div>
        </div>

        <div class="report-info-card" style="margin-bottom:20px;">
          <h3>Como se comunicar melhor com você</h3>
          <div id="report-communication"></div>
        </div>

        <div class="report-info-card">
          <h3>Ambiente onde você tende a render mais</h3>
          <div id="report-environment"></div>
        </div>
      </div>

      <div class="report-pdi-section">
        <h2>Plano de Desenvolvimento Individual - PDI</h2>
        <div id="report-pdi"></div>
      </div>

      <div class="report-thanks-section">
        <h2>Agradecimentos</h2>
        <p>Agradecemos por utilizar o serviço de avaliação de perfil do IAGO Mentor (iagomentor.com.br).</p>
        <p>Entender seu perfil comportamental é um passo importante no seu desenvolvimento pessoal e profissional.</p>
        <p>Use este resultado como base para refletir sobre pontos fortes, pontos de atenção e próximos passos.</p>

        <!-- FUTURO (opcional)
        <p class="mt-4"><strong>Em breve:</strong> versão completa para membros IAGO, com análise avançada e recomendações personalizadas.</p>
        -->
      </div>

      <div class="report-footer">
        Relatório elaborado por IAGO Mentor - Direitos Reservados
      </div>
    </div>
  </template>

  <script>
    // =========================
    // DADOS DO TESTE
    // =========================
    const discQuestions = [
      {
        question: "Em situações de trabalho em equipe, eu geralmente:",
        options: [
          { text: "Tomo a iniciativa e lidero as discussões", type: "D" },
          { text: "Motivo os outros e trago energia positiva", type: "I" },
          { text: "Ouço atentamente e apoio os colegas", type: "S" },
          { text: "Analiso cuidadosamente antes de contribuir", type: "C" }
        ]
      },
      {
        question: "Quando enfrento um problema, eu normalmente:",
        options: [
          { text: "Busco resolvê-lo rapidamente e sigo em frente", type: "D" },
          { text: "Discuto com outros para encontrar soluções criativas", type: "I" },
          { text: "Considero como a solução afetará as pessoas envolvidas", type: "S" },
          { text: "Analiso todas as informações disponíveis antes de decidir", type: "C" }
        ]
      },
      {
        question: "Meus colegas provavelmente me descreveriam como:",
        options: [
          { text: "Determinado e orientado a resultados", type: "D" },
          { text: "Entusiasta e comunicativo", type: "I" },
          { text: "Confiável e cooperativo", type: "S" },
          { text: "Preciso e meticuloso", type: "C" }
        ]
      },
      {
        question: "Em um ambiente de trabalho, eu valorizo mais:",
        options: [
          { text: "Eficiência e resultados concretos", type: "D" },
          { text: "Criatividade e oportunidades de expressão", type: "I" },
          { text: "Harmonia e boas relações interpessoais", type: "S" },
          { text: "Qualidade e processos bem estruturados", type: "C" }
        ]
      },
      {
        question: "Quando recebo uma nova tarefa, minha primeira reação é:",
        options: [
          { text: "Determinar como concluí-la da forma mais eficiente", type: "D" },
          { text: "Pensar em formas criativas de abordá-la", type: "I" },
          { text: "Considerar como ela se encaixa no contexto geral", type: "S" },
          { text: "Entender completamente os requisitos e expectativas", type: "C" }
        ]
      },
      {
        question: "Quando trabalho sob pressão, eu tendo a:",
        options: [
          { text: "Focar na meta e eliminar obstáculos", type: "D" },
          { text: "Manter o otimismo e inspirar os outros", type: "I" },
          { text: "Manter a calma e seguir um ritmo constante", type: "S" },
          { text: "Verificar detalhes para evitar erros", type: "C" }
        ]
      },
      {
        question: "Em relação a mudanças no trabalho, eu geralmente:",
        options: [
          { text: "Adapto-me rapidamente e busco oportunidades", type: "D" },
          { text: "Abraço a novidade e incentivo os outros", type: "I" },
          { text: "Preciso de tempo para me ajustar gradualmente", type: "S" },
          { text: "Quero entender o motivo e o impacto da mudança", type: "C" }
        ]
      },
      {
        question: "Ao tomar decisões importantes, eu prefiro:",
        options: [
          { text: "Ser direto e decidir rapidamente", type: "D" },
          { text: "Discutir opções com outras pessoas", type: "I" },
          { text: "Considerar como a decisão afetará a equipe", type: "S" },
          { text: "Analisar cuidadosamente prós e contras", type: "C" }
        ]
      },
      {
        question: "Quando recebo feedback negativo, eu geralmente:",
        options: [
          { text: "Vejo como um desafio a superar", type: "D" },
          { text: "Expresso meus sentimentos e busco apoio", type: "I" },
          { text: "Reflito sobre como melhorar sem confrontação", type: "S" },
          { text: "Analiso detalhadamente o que deu errado", type: "C" }
        ]
      },
      {
        question: "Em uma reunião, é mais provável que eu:",
        options: [
          { text: "Mantenha o foco nos objetivos e resultados", type: "D" },
          { text: "Contribua com ideias e estimule a discussão", type: "I" },
          { text: "Ouça atentamente e busque consenso", type: "S" },
          { text: "Faça perguntas detalhadas e tome notas", type: "C" }
        ]
      },
      {
        question: "Quando preciso convencer alguém, eu geralmente:",
        options: [
          { text: "Apresento argumentos diretos e objetivos", type: "D" },
          { text: "Uso entusiasmo e histórias envolventes", type: "I" },
          { text: "Mostro empatia e busco entendimento mútuo", type: "S" },
          { text: "Forneço dados e análises detalhadas", type: "C" }
        ]
      },
      {
        question: "Meu espaço de trabalho geralmente é:",
        options: [
          { text: "Funcional e orientado para eficiência", type: "D" },
          { text: "Criativo e com elementos pessoais", type: "I" },
          { text: "Confortável e acolhedor", type: "S" },
          { text: "Organizado e sistemático", type: "C" }
        ]
      },
      {
        question: "Quando trabalho em projetos, eu prefiro:",
        options: [
          { text: "Liderar e estabelecer o ritmo", type: "D" },
          { text: "Gerar ideias e inspirar a equipe", type: "I" },
          { text: "Apoiar os outros e manter a harmonia", type: "S" },
          { text: "Estruturar o processo e garantir qualidade", type: "C" }
        ]
      },
      {
        question: "Em situações de conflito, eu tendo a:",
        options: [
          { text: "Enfrentar o problema diretamente", type: "D" },
          { text: "Usar humor e comunicação para aliviar tensões", type: "I" },
          { text: "Buscar compromisso e restaurar a harmonia", type: "S" },
          { text: "Analisar a situação logicamente e com distanciamento", type: "C" }
        ]
      },
      {
        question: "Quando estabeleço metas pessoais, elas geralmente são:",
        options: [
          { text: "Ambiciosas e orientadas para resultados", type: "D" },
          { text: "Criativas e focadas em novas experiências", type: "I" },
          { text: "Equilibradas e alinhadas com valores pessoais", type: "S" },
          { text: "Específicas e com etapas bem definidas", type: "C" }
        ]
      },
      {
        question: "O que mais me motiva no trabalho é:",
        options: [
          { text: "Desafios e oportunidades de liderança", type: "D" },
          { text: "Reconhecimento e interação social", type: "I" },
          { text: "Estabilidade e ambiente de trabalho positivo", type: "S" },
          { text: "Excelência e oportunidades de especialização", type: "C" }
        ]
      },
      {
        question: "Quando preciso dar instruções a alguém, eu:",
        options: [
          { text: "Sou direto e foco no resultado esperado", type: "D" },
          { text: "Sou animado e destaco os aspectos positivos", type: "I" },
          { text: "Sou paciente e ofereço apoio contínuo", type: "S" },
          { text: "Sou detalhista e forneço instruções precisas", type: "C" }
        ]
      },
      {
        question: "Em relação ao tempo e prazos, eu geralmente:",
        options: [
          { text: "Trabalho com urgência e foco na entrega", type: "D" },
          { text: "Sou flexível e multitarefa", type: "I" },
          { text: "Mantenho um ritmo constante e confiável", type: "S" },
          { text: "Planejo cuidadosamente para cumprir os prazos", type: "C" }
        ]
      },
      {
        question: "Quando enfrento um obstáculo, minha reação típica é:",
        options: [
          { text: "Encontrar uma solução rápida e seguir em frente", type: "D" },
          { text: "Buscar alternativas criativas com outras pessoas", type: "I" },
          { text: "Persistir pacientemente até superar o desafio", type: "S" },
          { text: "Analisar o problema e desenvolver um plano sistemático", type: "C" }
        ]
      },
      {
        question: "Em uma conversa, eu geralmente:",
        options: [
          { text: "Vou direto ao ponto e sou conciso", type: "D" },
          { text: "Sou expressivo e compartilho histórias pessoais", type: "I" },
          { text: "Ouço mais do que falo e faço perguntas", type: "S" },
          { text: "Sou preciso e foco em informações relevantes", type: "C" }
        ]
      }
    ];

    const profileDescriptions = {
      D: {
        title: "Dominante",
        description: "Pessoas com alto perfil Dominante são diretas, decisivas e orientadas a resultados. Gostam de desafios, assumem riscos calculados e buscam eficiência. São líderes naturais que valorizam a autonomia e têm forte determinação para alcançar objetivos.",
        keywords: "Determinação, Assertividade, Objetividade, Competitividade, Independência",
        motivators: "Desafios, Controle, Resultados visíveis, Oportunidades de liderança, Reconhecimento por conquistas",
        team: "Assume posições de liderança, Toma decisões rapidamente, Mantém o foco nos resultados, Pode ser impaciente com processos lentos",
        commercial: "Excelente em negociações, Fecha vendas com determinação, Direto na abordagem com clientes, Orientado para metas e resultados",
        administrative: "Eficiente na gestão de processos, Foco em produtividade, Pode delegar detalhes, Prefere autonomia nas decisões",
        development: "Desenvolver habilidades de escuta ativa, Praticar paciência com processos mais lentos, Considerar o impacto emocional das decisões nos outros, Aprender a delegar tarefas de forma eficaz, Trabalhar o equilíbrio entre assertividade e empatia"
      },
      I: {
        title: "Influente",
        description: "Pessoas com alto perfil Influente são comunicativas, entusiasmadas e sociáveis. Valorizam relacionamentos, são persuasivas e motivadoras. Trazem energia positiva para equipes e são habilidosas em inspirar os outros.",
        keywords: "Entusiasmo, Sociabilidade, Persuasão, Otimismo, Expressividade",
        motivators: "Reconhecimento social, Popularidade, Liberdade de expressão, Ambientes dinâmicos, Interação com pessoas",
        team: "Motiva e inspira os colegas, Comunica-se de forma expressiva, Traz energia positiva, Pode dispersar-se em conversas",
        commercial: "Excelente em construir relacionamentos com clientes, Persuasivo e carismático, Entusiasmo contagiante, Habilidade para networking",
        administrative: "Criativo na resolução de problemas, Prefere ambientes flexíveis, Pode precisar de apoio com detalhes e prazos",
        development: "Desenvolver habilidades de organização e foco, Praticar a conclusão de tarefas antes de iniciar novas, Aprender a ouvir mais e falar menos em certas situações, Trabalhar com prazos e estruturas mais definidas, Equilibrar sociabilidade com produtividade"
      },
      S: {
        title: "Estável",
        description: "Pessoas com alto perfil Estável são pacientes, confiáveis e cooperativas. Valorizam harmonia, são bons ouvintes e trabalham bem em equipe. Demonstram lealdade e consistência em suas ações e relacionamentos.",
        keywords: "Paciência, Cooperação, Lealdade, Previsibilidade, Empatia",
        motivators: "Estabilidade, Harmonia nas relações, Segurança, Ambiente de trabalho positivo, Reconhecimento pela dedicação",
        team: "Promove harmonia e cooperação, Ouve atentamente os colegas, Apoia consistentemente a equipe, Adapta-se às necessidades do grupo",
        commercial: "Constrói relacionamentos duradouros com clientes, Excelente em serviço de atendimento, Confiável no cumprimento de promessas, Paciente com processos de venda longos",
        administrative: "Consistente e confiável, Mantém processos estáveis, Excelente em tarefas que exigem paciência, Prefere ambientes previsíveis",
        development: "Desenvolver assertividade e capacidade de expressar opiniões, Praticar a adaptação a mudanças rápidas, Aprender a estabelecer limites claros, Trabalhar a tomada de decisões mais ágil, Buscar mais iniciativa em situações novas"
      },
      C: {
        title: "Cauteloso",
        description: "Pessoas com alto perfil Cauteloso são analíticas, precisas e sistemáticas. Valorizam qualidade, seguem regras e procedimentos, e prestam atenção aos detalhes. Buscam excelência e tomam decisões baseadas em fatos e dados.",
        keywords: "Precisão, Análise, Organização, Qualidade, Lógica",
        motivators: "Qualidade, Processos bem definidos, Oportunidades para especialização, Ambientes estruturados, Reconhecimento pela excelência",
        team: "Garante precisão e qualidade, Analisa riscos e problemas potenciais, Mantém padrões elevados, Pode ser percebido como perfeccionista",
        commercial: "Excelente em apresentações técnicas detalhadas, Prepara-se minuciosamente para reuniões, Responde com precisão às dúvidas dos clientes, Cumpre rigorosamente os processos",
        administrative: "Extremamente organizado e metódico, Excelente em controle de qualidade, Atento aos detalhes e prazos, Prefere instruções claras",
        development: "Desenvolver flexibilidade diante de mudanças, Praticar tomada de decisões mais rápidas, Aprender a lidar com ambiguidades, Trabalhar habilidades de comunicação mais expressiva, Equilibrar análise com ação"
      }
    };

    const combinedDevelopmentPlans = {
      "DI": "Seu perfil combina liderança e comunicação. Foque em: 1) Desenvolver escuta ativa para equilibrar sua assertividade, 2) Aprender a concluir projetos antes de iniciar novos, 3) Praticar paciência com processos detalhados, 4) Equilibrar seu entusiasmo com análise crítica, 5) Trabalhar em feedback construtivo que inspire sem intimidar.",
      "DS": "Seu perfil combina determinação com estabilidade. Foque em: 1) Equilibrar velocidade de decisão com consideração pelos outros, 2) Desenvolver comunicação mais empática mantendo objetividade, 3) Praticar flexibilidade em seus métodos de trabalho, 4) Aprender a valorizar tanto o processo quanto o resultado, 5) Trabalhar em delegar tarefas sem microgerenciar.",
      "DC": "Seu perfil combina orientação a resultados com precisão analítica. Foque em: 1) Desenvolver paciência com processos necessários, 2) Equilibrar velocidade com qualidade, 3) Praticar habilidades interpessoais e empatia, 4) Aprender a comunicar decisões de forma mais inclusiva, 5) Trabalhar em flexibilidade quando os planos precisam mudar.",
      "IS": "Seu perfil combina entusiasmo com cooperação. Foque em: 1) Desenvolver habilidades de organização e conclusão de tarefas, 2) Equilibrar sociabilidade com produtividade, 3) Praticar assertividade quando necessário, 4) Aprender a estabelecer limites claros, 5) Trabalhar em consistência e acompanhamento de projetos.",
      "IC": "Seu perfil combina comunicação expressiva com pensamento analítico. Foque em: 1) Desenvolver disciplina para seguir processos, 2) Equilibrar criatividade com praticidade, 3) Praticar foco em uma tarefa por vez, 4) Aprender a basear entusiasmo em dados concretos, 5) Trabalhar em organização e gerenciamento de tempo.",
      "SC": "Seu perfil combina cooperação com precisão. Foque em: 1) Desenvolver assertividade e expressão de opiniões, 2) Equilibrar atenção aos detalhes com visão geral, 3) Praticar adaptação a mudanças rápidas, 4) Aprender a tomar decisões com mais agilidade, 5) Trabalhar em iniciativa e proatividade em situações novas."
    };

    // Leitura prática por perfil (para relatório)
    const practicalInsights = {
      D: {
        strengths: [
          "Decisão rápida e foco em resultado",
          "Iniciativa e senso de urgência",
          "Coragem para enfrentar desafios"
        ],
        watchouts: [
          "Impaciência com ritmo mais lento",
          "Tendência a ser direto demais sob pressão",
          "Risco de atropelar detalhes ou pessoas"
        ],
        communication: [
          "Vá direto ao ponto e traga opções",
          "Mostre impacto e resultado esperado",
          "Evite excesso de contexto antes da conclusão"
        ],
        environment: [
          "Metas claras, autonomia e desafios",
          "Ritmo dinâmico e poder de decisão",
          "Indicadores de performance visíveis"
        ]
      },
      I: {
        strengths: [
          "Comunicação e persuasão naturais",
          "Cria conexões e mobiliza pessoas",
          "Otimismo e energia em momentos difíceis"
        ],
        watchouts: [
          "Dispersão com muitas ideias ao mesmo tempo",
          "Pode evitar conflitos necessários",
          "Risco de prometer mais do que consegue entregar"
        ],
        communication: [
          "Use exemplos e visão inspiradora",
          "Alinhe prazos e combine próximos passos por escrito",
          "Reconheça esforços e participação"
        ],
        environment: [
          "Ambiente social, colaborativo e criativo",
          "Liberdade com limites claros",
          "Espaço para apresentar e influenciar"
        ]
      },
      S: {
        strengths: [
          "Consistência, lealdade e confiabilidade",
          "Boa escuta e suporte ao time",
          "Estabilidade em cenários de pressão"
        ],
        watchouts: [
          "Dificuldade com mudanças bruscas",
          "Pode evitar se posicionar em decisões",
          "Risco de assumir demais para agradar"
        ],
        communication: [
          "Explique mudanças com antecedência",
          "Dê contexto e segurança do plano",
          "Faça acordos claros e respeite o tempo"
        ],
        environment: [
          "Rotina organizada e previsível",
          "Times cooperativos e clima saudável",
          "Processos claros e ritmo constante"
        ]
      },
      C: {
        strengths: [
          "Análise, precisão e foco em qualidade",
          "Organização e pensamento sistêmico",
          "Boa gestão de risco e conformidade"
        ],
        watchouts: [
          "Perfeccionismo e demora para decidir",
          "Excesso de cautela em cenários incertos",
          "Pode soar frio ao priorizar lógica"
        ],
        communication: [
          "Traga dados, critérios e lógica",
          "Defina padrão de qualidade esperado",
          "Evite pressão por decisão sem informação mínima"
        ],
        environment: [
          "Processos definidos e padrões claros",
          "Tempo para análise e profundidade técnica",
          "Qualidade valorizada mais que urgência"
        ]
      }
    };

    // =========================
    // ESTADO
    // =========================
    let currentQuestion = 0;
    let scores = { D: 0, I: 0, S: 0, C: 0 };
    let userData = {};
    let userAnswers = new Array(discQuestions.length).fill(null);

    // =========================
    // DOM
    // =========================
    const userForm = document.getElementById('user-form');
    const testProgress = document.getElementById('test-progress');
    const questionsContainer = document.getElementById('questions-container');
    const resultsContainer = document.getElementById('results-container');
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const questionCounter = document.getElementById('question-counter');

    const startTestBtn = document.getElementById('start-test');
    const navigationButtons = document.getElementById('navigation-buttons');
    const prevButton = document.getElementById('prev-question');
    const nextButton = document.getElementById('next-question');

    const openReportBtn = document.getElementById('open-report');
    const downloadPdfBtn = document.getElementById('download-pdf');
    const printReportBtn = document.getElementById('print-report');

    const reportStage = document.getElementById('report-stage');
    const reportRoot = document.getElementById('report-root');
    const backToResultsBtn = document.getElementById('back-to-results');
    const stageDownloadPdfBtn = document.getElementById('stage-download-pdf');
    const stagePrintBtn = document.getElementById('stage-print');

    // =========================
    // INÍCIO
    // =========================
    startTestBtn.addEventListener('click', function () {
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const age = document.getElementById('age').value.trim();
      const profession = document.getElementById('profession').value.trim();

      if (!name || !email || !age || !profession) {
        alert('Por favor, preencha todos os campos antes de iniciar o teste.');
        return;
      }

      const consent = document.getElementById('lgpd-consent').checked;
      if (!consent) {
        alert('Para continuar, confirme a ciência sobre o uso de dados (LGPD).');
        return;
      }

      userData = {
        name,
        email,
        age,
        profession,
        date: new Date().toLocaleString('pt-BR')
      };

      userForm.classList.add('hidden');
      testProgress.classList.remove('hidden');
      questionsContainer.classList.remove('hidden');
      navigationButtons.classList.remove('hidden');

      showQuestion(currentQuestion);
      updateNavigationButtons();
    });

    // =========================
    // RENDER QUESTÕES
    // =========================
    function showQuestion(index) {
      const progress = Math.round(((index + 1) / discQuestions.length) * 100);
      progressBar.style.width = `${progress}%`;
      progressText.textContent = `${progress}%`;
      questionCounter.textContent = `Questão ${index + 1} de ${discQuestions.length}`;

      questionsContainer.innerHTML = '';

      const questionElement = document.createElement('div');
      questionElement.className = 'question-container mb-8';

      const questionText = document.createElement('h3');
      questionText.className = 'text-xl font-medium text-white mb-4';
      questionText.textContent = `${index + 1}. ${discQuestions[index].question}`;
      questionElement.appendChild(questionText);

      const optionsContainer = document.createElement('div');
      optionsContainer.className = 'space-y-3';

      discQuestions[index].options.forEach((option, optionIndex) => {
        const optionElement = document.createElement('div');
        optionElement.className = 'flex items-center p-3 border border-gray-700 rounded-md hover:bg-gray-800 cursor-pointer transition duration-200';

        if (userAnswers[index] !== null && userAnswers[index].type === option.type) {
          optionElement.classList.add('option-selected');
        }

        optionElement.dataset.type = option.type;
        optionElement.dataset.index = optionIndex;

        const radio = document.createElement('div');
        radio.className = 'w-5 h-5 rounded-full border-2 border-yellow-500 mr-3 flex items-center justify-center';

        if (userAnswers[index] !== null && userAnswers[index].type === option.type) {
          const dot = document.createElement('div');
          dot.className = 'w-3 h-3 rounded-full bg-yellow-500 radio-dot';
          radio.appendChild(dot);
        }

        const optionText = document.createElement('span');
        optionText.className = 'text-white';
        optionText.textContent = option.text;

        optionElement.appendChild(radio);
        optionElement.appendChild(optionText);

        optionElement.addEventListener('click', function () {
          const allOptions = optionsContainer.querySelectorAll('div[data-type]');
          allOptions.forEach(opt => {
            opt.classList.remove('option-selected');
            const radioInner = opt.querySelector('div.w-5');
            if (radioInner) {
              const dot = radioInner.querySelector('.radio-dot');
              if (dot) radioInner.removeChild(dot);
            }
          });

          optionElement.classList.add('option-selected');
          const dot = document.createElement('div');
          dot.className = 'w-3 h-3 rounded-full bg-yellow-500 radio-dot';
          radio.appendChild(dot);

          userAnswers[index] = { type: option.type, index: optionIndex };
          nextButton.disabled = false;
        });

        optionsContainer.appendChild(optionElement);
      });

      questionElement.appendChild(optionsContainer);
      questionsContainer.appendChild(questionElement);
    }

    function updateNavigationButtons() {
      prevButton.disabled = currentQuestion === 0;

      if (currentQuestion === discQuestions.length - 1) {
        nextButton.textContent = 'Ver Resultados';
        nextButton.disabled = userAnswers[currentQuestion] === null;
      } else {
        nextButton.textContent = 'Próxima';
        nextButton.disabled = userAnswers[currentQuestion] === null;
      }
    }

    prevButton.addEventListener('click', function () {
      if (currentQuestion > 0) {
        currentQuestion--;
        showQuestion(currentQuestion);
        updateNavigationButtons();
      }
    });

    nextButton.addEventListener('click', function () {
      if (userAnswers[currentQuestion] === null) {
        alert('Por favor, selecione uma resposta antes de continuar.');
        return;
      }

      if (currentQuestion < discQuestions.length - 1) {
        currentQuestion++;
        showQuestion(currentQuestion);
        updateNavigationButtons();
      } else {
        calculateResults();
      }
    });

    // =========================
    // RESULTADOS
    // =========================
    function calculateResults() {
      scores = { D: 0, I: 0, S: 0, C: 0 };
      userAnswers.forEach(answer => {
        if (answer !== null) scores[answer.type]++;
      });
      showResults();
    }

    function showResults() {
      testProgress.classList.add('hidden');
      questionsContainer.classList.add('hidden');
      navigationButtons.classList.add('hidden');
      resultsContainer.classList.remove('hidden');

      const total = Object.values(scores).reduce((sum, score) => sum + score, 0);
      const percentages = {};
      for (const type in scores) {
        percentages[type] = Math.round((scores[type] / total) * 100);
      }

      document.getElementById('d-column').style.height = `${percentages.D}%`;
      document.getElementById('i-column').style.height = `${percentages.I}%`;
      document.getElementById('s-column').style.height = `${percentages.S}%`;
      document.getElementById('c-column').style.height = `${percentages.C}%`;

      document.getElementById('d-percentage').textContent = `${percentages.D}%`;
      document.getElementById('i-percentage').textContent = `${percentages.I}%`;
      document.getElementById('s-percentage').textContent = `${percentages.S}%`;
      document.getElementById('c-percentage').textContent = `${percentages.C}%`;

      const sortedProfiles = Object.entries(percentages)
        .sort((a, b) => b[1] - a[1])
        .map(entry => entry[0]);

      const primaryProfile = sortedProfiles[0];
      const secondaryProfile = sortedProfiles[1];

      document.getElementById('profile-description').innerHTML = `
        <p class="font-bold mb-2">Seu perfil predominante é: ${profileDescriptions[primaryProfile].title} (${percentages[primaryProfile]}%) e ${profileDescriptions[secondaryProfile].title} (${percentages[secondaryProfile]}%)</p>
        <p>${profileDescriptions[primaryProfile].description}</p>
      `;

      userData.results = percentages;
      userData.primaryProfile = primaryProfile;
      userData.secondaryProfile = secondaryProfile;
      userData.profileTitle = `Perfil ${profileDescriptions[primaryProfile].title} e ${profileDescriptions[secondaryProfile].title}`;
      userData.combinedProfile = primaryProfile + secondaryProfile;

      downloadPdfBtn.disabled = false;
      printReportBtn.disabled = false;
    }

    // =========================
    // RELATÓRIO NA TELA
    // =========================
    function renderReportToStage() {
      reportRoot.innerHTML = '';
      const tpl = document.getElementById('report-template');
      const clone = tpl.content.cloneNode(true);
      reportRoot.appendChild(clone);

      reportRoot.querySelector('#report-user-data').innerHTML = `
        <p><strong>Nome:</strong> ${escapeHtml(userData.name)}</p>
        <p><strong>E-mail:</strong> ${escapeHtml(userData.email)}</p>
        <p><strong>Idade:</strong> ${escapeHtml(userData.age)}</p>
        <p><strong>Profissão:</strong> ${escapeHtml(userData.profession)}</p>
        <p><strong>Data e hora do teste:</strong> ${escapeHtml(userData.date)}</p>
      `;

      reportRoot.querySelector('#report-d-column').style.height = `${userData.results.D}%`;
      reportRoot.querySelector('#report-i-column').style.height = `${userData.results.I}%`;
      reportRoot.querySelector('#report-s-column').style.height = `${userData.results.S}%`;
      reportRoot.querySelector('#report-c-column').style.height = `${userData.results.C}%`;

      reportRoot.querySelector('#report-d-percentage').textContent = `${userData.results.D}%`;
      reportRoot.querySelector('#report-i-percentage').textContent = `${userData.results.I}%`;
      reportRoot.querySelector('#report-s-percentage').textContent = `${userData.results.S}%`;
      reportRoot.querySelector('#report-c-percentage').textContent = `${userData.results.C}%`;

      reportRoot.querySelector('#report-profile-title').textContent = userData.profileTitle;
      reportRoot.querySelector('#report-profile-description').innerHTML = `
        <p>${profileDescriptions[userData.primaryProfile].description}</p>
        <p class="mt-3">Como perfil secundário ${profileDescriptions[userData.secondaryProfile].title}, você também apresenta:
        ${profileDescriptions[userData.secondaryProfile].description.split('.')[0]}.</p>
      `;

      const otherProfiles = Object.keys(profileDescriptions).filter(
        p => p !== userData.primaryProfile && p !== userData.secondaryProfile
      );

      reportRoot.querySelector('#report-profiles-description').innerHTML = `
        <div class="mb-4">
          <h3 class="font-semibold text-lg" style="color: #f2bf41;">${profileDescriptions[userData.primaryProfile].title} (Perfil Primário - ${userData.results[userData.primaryProfile]}%)</h3>
          <p>${profileDescriptions[userData.primaryProfile].description}</p>
        </div>
        <div class="mb-4">
          <h3 class="font-semibold text-lg" style="color: #f2bf41;">${profileDescriptions[userData.secondaryProfile].title} (Perfil Secundário - ${userData.results[userData.secondaryProfile]}%)</h3>
          <p>${profileDescriptions[userData.secondaryProfile].description}</p>
        </div>
        <div class="mb-4">
          <h3 class="font-semibold text-lg" style="color: #f2bf41;">${profileDescriptions[otherProfiles[0]].title} (${userData.results[otherProfiles[0]]}%)</h3>
          <p>${profileDescriptions[otherProfiles[0]].description.split('.')[0]}.</p>
        </div>
        <div>
          <h3 class="font-semibold text-lg" style="color: #f2bf41;">${profileDescriptions[otherProfiles[1]].title} (${userData.results[otherProfiles[1]]}%)</h3>
          <p>${profileDescriptions[otherProfiles[1]].description.split('.')[0]}.</p>
        </div>
      `;

      reportRoot.querySelector('#report-keywords').innerHTML = `
        <p>${profileDescriptions[userData.primaryProfile].keywords}</p>
        <p class="mt-2">Secundário: ${profileDescriptions[userData.secondaryProfile].keywords.split(',').slice(0, 2).join(',')}</p>
      `;
      reportRoot.querySelector('#report-motivators').innerHTML = `
        <p>${profileDescriptions[userData.primaryProfile].motivators}</p>
        <p class="mt-2">Secundário: ${profileDescriptions[userData.secondaryProfile].motivators.split(',').slice(0, 2).join(',')}</p>
      `;
      reportRoot.querySelector('#report-team').innerHTML = `
        <p>${profileDescriptions[userData.primaryProfile].team}</p>
        <p class="mt-2">Secundário: ${profileDescriptions[userData.secondaryProfile].team.split(',').slice(0, 2).join(',')}</p>
      `;
      reportRoot.querySelector('#report-commercial').innerHTML = `
        <p>${profileDescriptions[userData.primaryProfile].commercial}</p>
        <p class="mt-2">Secundário: ${profileDescriptions[userData.secondaryProfile].commercial.split(',').slice(0, 2).join(',')}</p>
      `;
      reportRoot.querySelector('#report-administrative').innerHTML = `
        <p>${profileDescriptions[userData.primaryProfile].administrative}</p>
        <p class="mt-2">Secundário: ${profileDescriptions[userData.secondaryProfile].administrative.split(',').slice(0, 2).join(',')}</p>
      `;

      // Leitura prática (mix primário + secundário)
      const primary = userData.primaryProfile;
      const secondary = userData.secondaryProfile;

      function mix(primaryArr, secondaryArr, takeSecondary = 2) {
        const a = [...primaryArr];
        const b = secondaryArr.slice(0, takeSecondary);
        return [...a, ...b];
      }

      reportRoot.querySelector('#report-strengths').innerHTML =
        `<ul style="margin:0;padding-left:18px;">
          ${mix(practicalInsights[primary].strengths, practicalInsights[secondary].strengths)
            .map(x => `<li>${x}</li>`).join('')}
        </ul>`;

      reportRoot.querySelector('#report-watchouts').innerHTML =
        `<ul style="margin:0;padding-left:18px;">
          ${mix(practicalInsights[primary].watchouts, practicalInsights[secondary].watchouts)
            .map(x => `<li>${x}</li>`).join('')}
        </ul>`;

      reportRoot.querySelector('#report-communication').innerHTML =
        `<ul style="margin:0;padding-left:18px;">
          ${mix(practicalInsights[primary].communication, practicalInsights[secondary].communication, 1)
            .map(x => `<li>${x}</li>`).join('')}
        </ul>`;

      reportRoot.querySelector('#report-environment').innerHTML =
        `<ul style="margin:0;padding-left:18px;">
          ${mix(practicalInsights[primary].environment, practicalInsights[secondary].environment, 1)
            .map(x => `<li>${x}</li>`).join('')}
        </ul>`;

      // PDI
      const combinedKey = userData.primaryProfile + userData.secondaryProfile;
      let pdiText = '';
      if (combinedDevelopmentPlans[combinedKey]) {
        pdiText = combinedDevelopmentPlans[combinedKey];
      } else {
        pdiText = `<p>Com base no seu perfil predominante ${profileDescriptions[userData.primaryProfile].title} (${userData.results[userData.primaryProfile]}%) e secundário ${profileDescriptions[userData.secondaryProfile].title} (${userData.results[userData.secondaryProfile]}%), recomendamos focar nas seguintes áreas de desenvolvimento:</p>
          <p class="mt-3"><strong>Para desenvolver seu perfil ${profileDescriptions[userData.primaryProfile].title}:</strong><br>
          ${profileDescriptions[userData.primaryProfile].development}</p>
          <p class="mt-3"><strong>Para equilibrar com seu perfil secundário ${profileDescriptions[userData.secondaryProfile].title}:</strong><br>
          ${profileDescriptions[userData.secondaryProfile].development.split(',').slice(0, 3).join(',')}</p>`;
      }
      reportRoot.querySelector('#report-pdi').innerHTML = pdiText;
    }

    function escapeHtml(str) {
      return String(str ?? '')
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
    }

    function showReportStage() {
      renderReportToStage();
      document.getElementById('test-container').classList.add('hidden');
      reportStage.classList.remove('hidden');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function backToResults() {
      reportStage.classList.add('hidden');
      document.getElementById('test-container').classList.remove('hidden');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    openReportBtn.addEventListener('click', showReportStage);

    downloadPdfBtn.addEventListener('click', async () => {
      showReportStage();
      await downloadReportPdf();
    });

    printReportBtn.addEventListener('click', () => {
      showReportStage();
      setTimeout(() => window.print(), 150);
    });

    backToResultsBtn.addEventListener('click', backToResults);
    stageDownloadPdfBtn.addEventListener('click', downloadReportPdf);
    stagePrintBtn.addEventListener('click', () => window.print());

    // =========================
    // PDF
    // =========================
    async function downloadReportPdf() {
      reportStage.classList.remove('hidden');

      const target = document.getElementById('report-for-pdf');
      if (!target) {
        alert('Relatório não encontrado para gerar PDF.');
        return;
      }

      await new Promise(r => setTimeout(r, 150));

      const canvas = await html2canvas(target, {
        scale: 2,
        useCORS: true,
        backgroundColor: '#121212'
      });

      const imgData = canvas.toDataURL('image/png');

      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p', 'mm', 'a4');

      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();

      const imgWidth = pageWidth;
      const imgHeight = (canvas.height * imgWidth) / canvas.width;

      let heightLeft = imgHeight;
      let position = 0;

      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight, undefined, 'FAST');
      heightLeft -= pageHeight;

      while (heightLeft > 0) {
        position = -(imgHeight - heightLeft);
        pdf.addPage();
        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight, undefined, 'FAST');
        heightLeft -= pageHeight;
      }

      const safeName = (userData.name || 'participante').toString().trim().replace(/\s+/g, '_');
      pdf.save(`Relatorio_DISC_IAGO_Mentor_${safeName}.pdf`);
    }
  </script>
</body>
</html>
